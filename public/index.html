<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Drawly – Gewinnspielauslosung</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display&family=Poppins:wght@300;500&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: #fdf6f0;
      color: #5b3e31;
      text-align: center;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 40px;
    }
    .logo {
      font-family: 'Playfair Display', serif;
      font-size: 1.8em;
      color: #a97c50;
    }
    .hidden {
      display: none;
    }
    section {
      max-width: 600px;
      margin: 0 auto;
      padding: 40px 20px;
    }
    input[type="text"], input[type="number"] {
      padding: 12px;
      width: 100%;
      max-width: 500px;
      border: 1px solid #d7ccc8;
      border-radius: 8px;
      margin-top: 10px;
    }
    button {
      margin-top: 20px;
      padding: 12px 24px;
      background: linear-gradient(90deg, #c19a6b, #d8b89c);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1em;
      cursor: pointer;
    }
    button:hover {
      background: linear-gradient(90deg, #b3865a, #cfa88c);
    }
   .box {
  background: #fffaf6;
  border: 1px solid #e6dcd5;
  border-radius: 12px;
  padding: 20px 25px;
  margin-top: 30px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
}
.box input[type="text"], .box input[type="number"] {
  margin-top: 5px;
  padding: 10px;
  border-radius: 6px;
  border: 1px solid #dcd3c9;
  width: 100%;
}
.box label {
  display: block;
  margin-bottom: 16px;
}
    .preview-img {
      width: 100%;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">Drawly</div>
  </header>
    <!-- Screen 1: Link eingeben -->
  <section id="screen1">
    <h1>Starte dein Gewinnspiel</h1>
    <p>Füge den Link zu deinem Social-Media-Post ein:</p>
    <input type="text" id="linkInput" placeholder="https://instagram.com/p/..." />
    <br>
    <button onclick="goToPreview()">Weiter</button>
  </section>
    <!-- Screen 2: Vorschau -->
  <section id="screen2" class="hidden">
    <h1>Dein Post im Überblick</h1>
    <div class="box">
      <img src="https://via.placeholder.com/500x300.png?text=Post+Vorschau" alt="Post-Vorschau" class="preview-img" id="previewImage" />
      <p id="likes">Likes: 532</p>
      <p id="comments">Kommentare: 134</p>
    </div>
    <p style="margin-top: 10px;">Anzahl der Kommentare bestimmt den Preis</p>
    <button onclick="goToFilters()">Kriterien festlegen</button>
  </section>
    <!-- Screen 3: Kriterien -->
<section id="screen3" class="hidden">
  <h1>Kriterien festlegen</h1>
  <div class="box" style="text-align: left;">
    <label>
      <input type="checkbox" id="requireHashtag">
      Kommentar enthält bestimmten Hashtag
    </label>
    <input type="text" id="hashtagInput" placeholder="#BohoGiveaway" style="margin-left: 10px;"><br><br>

    <label>
      <input type="checkbox" id="requireMention">
      Teilnehmer hat Freunde markiert
    </label>
    <input type="number" id="mentionCount" value="1" min="1" style="width: 60px; margin-left: 10px;"> Freunde<br><br>

    <label>
      <input type="checkbox" id="requireFollow">
      Teilnehmer folgt deinem Account
    </label><br><br>

    <label>
      Anzahl Gewinner:
      <input type="number" id="winnerCount" value="1" min="1" max="10" style="width: 60px;">
    </label>
  </div>
  <button onclick="startDraw()">Auslosung starten</button>
</section>
    <!-- Screen 4: Auslosung -->
  <section id="screen4" class="hidden">
    <h1>Ziehung läuft...</h1>
    <div id="drawly-result" style="font-size: 2em; margin-top: 30px;">...</div>
    <div id="dreamcatcher">
      <svg width="180" height="270" viewBox="0 0 200 300" xmlns="http://www.w3.org/2000/svg" class="swing">
        <circle cx="100" cy="70" r="50" stroke="#a97c50" stroke-width="4" fill="none"/>
        <line x1="100" y1="20" x2="100" y2="120" stroke="#a97c50" stroke-width="1"/>
        <line x1="70" y1="40" x2="130" y2="100" stroke="#a97c50" stroke-width="1"/>
        <line x1="130" y1="40" x2="70" y2="100" stroke="#a97c50" stroke-width="1"/>
        <line x1="85" y1="120" x2="85" y2="180" stroke="#a97c50" stroke-width="2"/>
        <line x1="100" y1="120" x2="100" y2="180" stroke="#a97c50" stroke-width="2"/>
        <line x1="115" y1="120" x2="115" y2="180" stroke="#a97c50" stroke-width="2"/>
        <path class="feather" d="M85 180 Q80 190 85 200 Q90 210 85 220" stroke="#c19a6b" fill="none" stroke-width="2"/>
        <path class="feather" d="M100 180 Q95 190 100 200 Q105 210 100 220" stroke="#c19a6b" fill="none" stroke-width="2"/>
        <path class="feather" d="M115 180 Q110 190 115 200 Q120 210 115 220" stroke="#c19a6b" fill="none" stroke-width="2"/>
      </svg>
    </div>
    <div id="successMessage" style="display:none; margin-top: 30px;">
      <p>Herzlichen Glückwunsch!</p>
      <button onclick="shareResult()">Ergebnis teilen</button>
    </div>
  </section>
  <script>
  const comments = [
    {
      user: "@sunlover",
      text: "Ich will gewinnen! #BohoGiveaway @friend1 @friend2",
      mentions: 2,
      follows: ["@drawly.io", "@boho_shop"]
    },
    {
      user: "@moonbeam",
      text: "Lieb’s hier! #vibes",
      mentions: 1,
      follows: ["@vibes_inspo"]
    },
    {
      user: "@drawlyfan",
      text: "#BohoGiveaway für mich @bestie @soulmate",
      mentions: 2,
      follows: ["@drawly.io", "@boho_shop", "@vibes_inspo"]
    }
  ];

  function startDraw() {
    showScreen("screen4");
    document.getElementById("successMessage").style.display = "none";
    document.getElementById("dreamcatcher").style.display = "block";
    const output = document.getElementById("drawly-result");

    // Kriterien holen
    const requireHashtag = document.getElementById("requireHashtag").checked;
    const hashtag = document.getElementById("hashtagInput").value.trim().toLowerCase();

    const requireMention = document.getElementById("requireMention").checked;
    const minMentions = parseInt(document.getElementById("mentionCount").value, 10);

    const requireFollow = document.getElementById("requireFollow").checked;
    const requiredFollows = document.getElementById("followAccounts").value
      .split(",")
      .map(a => a.trim().toLowerCase())
      .filter(a => a.startsWith("@"));

    const winnerCount = parseInt(document.getElementById("winnerCount").value, 10);

    // Kommentare prüfen
    const valid = comments.filter(c => {
      const hasHashtag = !requireHashtag || (hashtag && c.text.toLowerCase().includes(hashtag));
      const hasMentions = !requireMention || c.mentions >= minMentions;
      const follows = !requireFollow || requiredFollows.every(req =>
        (c.follows || []).map(f => f.toLowerCase()).includes(req)
      );
      return hasHashtag && hasMentions && follows;
    });

    if (valid.length === 0) {
      output.innerHTML = "<div style='color:#b84c4c; font-weight:500;'>Keine Teilnehmer erfüllen die Kriterien.</div>";
      document.getElementById("dreamcatcher").style.display = "none";
      return;
    }

    // Slot-Effekt
    let i = 0;
    const names = valid.map(c => c.user);
    const interval = setInterval(() => {
      output.textContent = names[i % names.length];
      i++;
    }, 120);

    setTimeout(() => {
      clearInterval(interval);
      const winners = [];
      while (winners.length < winnerCount && names.length > 0) {
        const randIndex = Math.floor(Math.random() * names.length);
        winners.push(names.splice(randIndex, 1)[0]);
      }
      output.innerHTML = `
        <div style="background: #fffaf6; border: 1px solid #e6dcd5; border-radius: 12px; padding: 20px; margin-top: 20px;">
          <h2 style="color:#a97c50; font-family:'Playfair Display', serif;">Gewinner</h2>
          <p style="font-size: 1.4em;">${winners.join("<br>")}</p>
        </div>`;
      document.getElementById("dreamcatcher").style.display = "none";
      document.getElementById("successMessage").style.display = "block";
      launchConfetti();
    }, 3500);
  }
</script>
